<!DOCTYPE html>
<html lang="#{!empty request.remoteUser ? user.locale.language : request.locale.language}"
	xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:cc="http://xmlns.jcp.org/jsf/composite" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions" xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions" xmlns:o="http://omnifaces.org/ui"
	xmlns:of="http://omnifaces.org/functions" xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

<f:metadata>
	<ui:param name="bean" value="#{dataController}" />
	<o:enableRestorableView />
</f:metadata>

<f:view locale="#{request.locale}" contentType="text/html" encoding="UTF-8">
	<h:head>
		<meta http-equiv="X-UA-Compatible" content1="IE=Edge,chrome=1" />
		<title>COVID-19</title>
		<link rel="shortcut icon" type="image/x-icon" href="#{resource['favicon.ico']}" />
	</h:head>

	<h:body>
		<h:outputScript library="omnifaces" name="fixviewstate.js" target="head" />
		<h:outputStylesheet name="app.css" />
		<h:outputScript name="app.js" />



		<h:form>
			<ui:param name="region" value="#{bean.selectedNode.data}" />
			<ui:param name="record" value="#{region.latestRecord}" />

			<p:layout fullPage="false" stateful="false" style="height:100%; padding:5px;">
				<p:layoutUnit position="center">
					<p:tree widgetVar="tree" var="data" value="#{bean.rootNode}" selectionMode="single" animate="true" highlight="true"
						styleClass="app-no-border">
						<p:ajax event="select" listener="#{bean.onSelect}" process="@this" update="@form:detail" />

						<p:treeNode>
							<h:outputLabel value="[#{of:formatDate(data.latestRecord.registered, 'yyyy-MM-dd')}] #{data.name}" />
						</p:treeNode>
					</p:tree>
				</p:layoutUnit>

				<p:layoutUnit position="east" size="75%" minSize="150">
					<p:outputPanel id="detail">
						<div class="section">
							<div>
								<div>#{bundle.region}</div>
								<div>#{region.name}</div>
							</div>
							<div>
								<div>#{bundle.population}</div>
								<div>#{of:formatNumberDefault(region.population)}</div>
							</div>
							<div>
								<div>#{bundle.latitude}</div>
								<div>#{region.latitude}</div>
							</div>
							<div>
								<div>#{bundle.longitude}</div>
								<div>#{region.longitude}</div>
							</div>

							<div>
								<div>#{bundle.lastUpdate}</div>
								<div>#{record.registered}</div>
							</div>

							<div>
								<div>#{bundle.aggregate}</div>
								<div>#{record.aggregate}</div>
							</div>
						</div>

						<br />
						<br />

						<p:selectOneRadio id="property" value="#{bean.property}" layout="custom">
							<p:ajax listener="#{bean.buildCharts}" process="@this" update="chartPanel" />
							<f:selectItem itemValue="confirmed" itemLabel="#{bundle.confirmed} [#{record.confirmed}]" />
							<f:selectItem itemValue="deceased" itemLabel="#{bundle.deceased} [#{record.deceased}]" />
							<f:selectItem itemValue="recovered" itemLabel="#{bundle.recovered} [#{record.recovered}]" />
							<f:selectItem itemValue="tested" itemLabel="#{bundle.tested} [#{record.tested}]" />
							<f:selectItem itemValue="quarantined" itemLabel="#{bundle.quarantined} [#{record.quarantined}]" />
							<f:selectItem itemValue="standardCare" itemLabel="#{bundle.standardCare} [#{record.standardCare}]" />
							<f:selectItem itemValue="intensiveCare" itemLabel="#{bundle.intensiveCare} [#{record.intensiveCare}]" />
							<f:selectItem itemValue="confirmedDelta" itemLabel="#{bundle.confirmedDelta} [#{record.confirmedDelta}]" />
							<f:selectItem itemValue="deceasedDelta" itemLabel="#{bundle.deceasedDelta} [#{record.deceasedDelta}]" />
							<f:selectItem itemValue="recoveredDelta" itemLabel="#{bundle.recoveredDelta} [#{record.recoveredDelta}]" />
							<f:selectItem itemValue="testedDelta" itemLabel="#{bundle.testedDelta} [#{record.testedDelta}]" />
						</p:selectOneRadio>

						<div class="section">
							<div style="display: flex; align-items: center;">
								<div style="margin-right: 4px">
									<p:radioButton for="property" itemIndex="0" />
								</div>
								<div>
									<div>#{bundle.confirmed}</div>
									<div>#{of:formatNumberDefault(record.confirmed)}</div>
									<div>#{record.confirmedDelta >= 0 ? '+' : ''}#{of:formatNumberDefault(record.confirmedDelta)}</div>
									<div>#{of:formatNumber(record.confirmedDeltaPercent, '+0.00%;-0.00%')}</div>
								</div>
							</div>
							<div style="display: flex; align-items: center;">
								<div style="margin-right: 4px">
									<p:radioButton for="property" itemIndex="1" />
								</div>
								<div>
									<div>#{bundle.deceased}</div>
									<div>#{of:formatNumberDefault(record.deceased)}</div>
									<div>#{record.deceasedDelta >= 0 ? '+' : ''}#{of:formatNumberDefault(record.deceasedDelta)}</div>
									<div>#{of:formatNumber(record.deceasedDeltaPercent, '+0.00%;-0.00%')}</div>
								</div>
							</div>
							<div style="display: flex; align-items: center;">
								<div style="margin-right: 4px">
									<p:radioButton for="property" itemIndex="2" />
								</div>
								<div>
									<div>#{bundle.recovered}</div>
									<div>#{of:formatNumberDefault(record.recovered)}</div>
									<div>#{record.recoveredDelta >= 0 ? '+' : ''}#{of:formatNumberDefault(record.recoveredDelta)}</div>
									<div>#{of:formatNumber(record.recoveredDeltaPercent, '+0.00%;-0.00%')}</div>
								</div>
							</div>
							<div style="display: flex; align-items: center;">
								<div style="margin-right: 4px">
									<p:radioButton for="property" itemIndex="3" />
								</div>
								<div>
									<div>#{bundle.tested}</div>
									<div>#{of:formatNumberDefault(record.tested)}</div>
									<div>#{record.testedDelta >= 0 ? '+' : ''}#{of:formatNumberDefault(record.testedDelta)}</div>
									<div>#{of:formatNumber(record.testedDeltaPercent, '+0.00%;-0.00%')}</div>
								</div>
							</div>
							<div style="display: flex; align-items: center;">
								<div style="margin-right: 4px">
									<p:radioButton for="property" itemIndex="4" />
								</div>
								<div>
									<div>#{bundle.quarantined}</div>
									<div>#{of:formatNumberDefault(record.quarantined)}</div>
									<div>#{record.quarantinedDelta >= 0 ? '+' : ''}#{of:formatNumberDefault(record.quarantinedDelta)}</div>
									<div>#{of:formatNumber(record.quarantinedDeltaPercent, '+0.00%;-0.00%')}</div>
								</div>
							</div>
							<div style="display: flex; align-items: center;">
								<div style="margin-right: 4px">
									<p:radioButton for="property" itemIndex="5" />
								</div>
								<div>
									<div>#{bundle.standardCare}</div>
									<div>#{of:formatNumberDefault(record.standardCare)}</div>
									<div>#{record.standardCareDelta >= 0 ? '+' : ''}#{of:formatNumberDefault(record.standardCareDelta)}</div>
									<div>#{of:formatNumber(record.standardCareDeltaPercent, '+0.00%;-0.00%')}</div>
								</div>
							</div>
							<div style="display: flex; align-items: center;">
								<div style="margin-right: 4px">
									<p:radioButton for="property" itemIndex="6" />
								</div>
								<div>
									<div>#{bundle.intensiveCare}</div>
									<div>#{of:formatNumberDefault(record.intensiveCare)}</div>
									<div>#{record.intensiveCareDelta >= 0 ? '+' : ''}#{of:formatNumberDefault(record.intensiveCareDelta)}</div>
									<div>#{of:formatNumber(record.intensiveCareDeltaPercent, '+0.00%;-0.00%')}</div>
								</div>
							</div>
						</div>

						<br />
						<br />

						<div class="section">
							<div>
								<div>#{bundle.active}</div>
								<div>#{of:formatNumberDefault(record.active)}</div>
								<div>#{record.activeDelta >= 0 ? '+' : ''}#{of:formatNumberDefault(record.activeDelta)}</div>
								<div>#{of:formatNumber(record.activeDeltaPercent, '+0.00%;-0.00%')}</div>
							</div>
							<div>
								<div>#{bundle.closed}</div>
								<div>#{of:formatNumberDefault(record.closed)}</div>
								<div>#{record.closedDelta >= 0 ? '+' : ''}#{of:formatNumberDefault(record.closedDelta)}</div>
								<div>#{of:formatNumber(record.closedDeltaPercent, '+0.00%;-0.00%')}</div>
							</div>
							<div>
								<div>#{bundle.hospitalized}</div>
								<div>#{of:formatNumberDefault(record.hospitalized)}</div>
								<div>#{record.hospitalizedDelta >= 0 ? '+' : ''}#{of:formatNumberDefault(record.hospitalizedDelta)}</div>
								<div>#{of:formatNumber(record.hospitalizedDeltaPercent, '+0.00%;-0.00%')}</div>
							</div>
							<div>
								<div>#{bundle.workload}</div>
								<div>#{of:formatNumberDefault(record.workload)}</div>
								<div>#{record.workloadDelta >= 0 ? '+' : ''}#{of:formatNumberDefault(record.workloadDelta)}</div>
								<div>#{of:formatNumber(record.workloadDeltaPercent, '+0.00%;-0.00%')}</div>
							</div>


							<div>
								<div>#{bundle.lethality}</div>
								<div>#{of:formatNumber(record.lethality, '0.00%')}</div>
								<div>#{of:formatNumber(record.lethalityDelta, '+0.00%;-0.00%')}</div>
							</div>
							<div>
								<div>#{bundle.hypotheticalInfected}</div>
								<div>#{of:formatNumberDefault(record.hypotheticalInfected)}</div>
								<div>#{of:formatNumberDefault(record.hypotheticalInfectedDelta)}</div>
							</div>
						</div>

						<!-- <br/>
						
						<p:dataTable var="record" value="#{region.records}" rows="10" paginator="true" paginatorPosition="bottom">
							<p:column headerText="#{bundle.registered}">
								#{record.registered}
							</p:column>
							<p:column headerText="#{bundle.confirmed}">
								#{record.confirmed}
							</p:column>
							<p:column headerText="#{bundle.deceased}">
								#{record.deceased}
							</p:column>
							<p:column headerText="#{bundle.recovered}">
								#{record.recovered}
							</p:column>
						</p:dataTable> -->

						<br />
						<br />

						<p:outputPanel id="chartPanel">
							<div style="display: flex; justify-content: space-evenly;">
								<label>#{bundle.interval}</label>

								<div>
									<p:commandButton action="#{bean.lastWeek}" process="chartPanel" update="chartPanel" value="#{bundle.lastWeek}" />
									<p:commandButton action="#{bean.lastMonth}" process="chartPanel" update="chartPanel"
										value="#{bundle.lastMonth}" />
									<p:commandButton action="#{bean.fullInterval}" process="chartPanel" update="chartPanel"
										value="#{bundle.fullInterval}" />
								</div>

								<p:calendar value="#{bean.startDate}" mindate="#{bean.minDate}" maxdate="#{bean.maxDate}" pattern="yyyy-MM-dd"
									size="8">
									<p:ajax event="dateSelect" listener="#{bean.buildCharts}" process="chartPanel" update="chartPanel" />
								</p:calendar>

								<p:calendar value="#{bean.endDate}" mindate="#{bean.minDate}" maxdate="#{bean.maxDate}" pattern="yyyy-MM-dd"
									size="8">
									<p:ajax event="dateSelect" listener="#{bean.buildCharts}" process="chartPanel" update="chartPanel" />
								</p:calendar>

								<p:commandButton action="#{bean.buildCharts}" value="#{bundle.comparisonNode}" process="chartPanel"
									update="chartPanel">
									<f:setPropertyActionListener target="#{bean.comparisonNode}" value="#{bean.selectedNode}" />
								</p:commandButton>
							</div>

							<br />

							<p:tabView dynamic="true">
								<p:tab title="#{bundle[bean.property]}">
									<p:chart rendered="#{bean.valueChart != null}" type="line" model="#{bean.valueChart}" responsive="true" />
								</p:tab>
								<p:tab title="#{bundle[bean.property += 'Delta']}">
									<p:chart rendered="#{bean.deltaChart != null}" type="line" model="#{bean.deltaChart}" responsive="true" />
								</p:tab>
								<p:tab title="#{bundle[bean.property += 'DeltaPercent']}">
									<p:chart rendered="#{bean.percentChart != null}" type="line" model="#{bean.percentChart}" responsive="true" />
								</p:tab>
							</p:tabView>
						</p:outputPanel>
					</p:outputPanel>
				</p:layoutUnit>
			</p:layout>
		</h:form>

		<!-- <h:outputScript name="jqplot.canvasOverlay.min.js" target="head" />
		<h:outputScript target="head">
			function chartExtender()
			{
				this.cfg.axes = {
                    xaxis: {
                        renderer: $.jqplot.DateAxisRenderer,
                        rendererOptions: {
                            tickRenderer: $.jqplot.CanvasAxisTickRenderer
                        },
                        tickOptions: {
                            fontSize: '10pt',
                            angle: -60,
                            formatString: '%m-%d'
                        },
                        title: 'Datum'
                    }
                };
			
				this.cfg.canvasOverlay = {
		            show: true,
		            objects: [
	            	{
		            	verticalLine: {
				            shadow: false,
				            lineWidth: 2,
				            color: "rgb(255,0,0)",
				            x: 16.5 
						}
					}, 
					{
						verticalLine: {
				            shadow: false,
				            lineWidth: 2,
				            color: "rgb(0,255,0)",
				            x: 31.5 
						}
					}]
				};
			};
		</h:outputScript> -->
	</h:body>
</f:view>
</html>
